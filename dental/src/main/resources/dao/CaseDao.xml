<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ricky.dentalclinic.dental.dao.CaseDao">
    <update id="deleteCase">
        UPDATE t_case
        SET
        is_delete = #{is_delete}
        WHERE
        id = #{id}
    </update>
    <select id="listCase" resultType="com.ricky.dentalclinic.dental.domain.CaseResultWithDentist">
        SELECT tc.*, tu.name as dentistName
        FROM
        t_case tc
        LEFT JOIN
        t_user tu
        ON
        tc.dentist_id = tu.id
        WHERE
        tc.is_delete = 0
        <if test="queryParam.name != null and queryParam.name != ''">
            AND tc.name LIKE concat("%",#{queryParam.name},"%")
        </if>
        <if test="queryParam.sex != null and queryParam.sex != ''">
            AND tc.sex = #{queryParam.sex}
        </if>
        <if test="queryParam.birthday != null and queryParam.birthday != ''">
            AND tc.birthday LIKE concat("%",#{queryParam.birthday},"%")
        </if>
        <if test="queryParam.phoneNumber != null and queryParam.phoneNumber != ''">
            AND tc.phone_number LIKE concat("%",#{queryParam.phoneNumber},"%")
        </if>
        <if test="queryParam.date != null and queryParam.date != ''">
            AND tc.date LIKE concat("%",#{queryParam.date},"%")
        </if>
        <if test="queryParam.caseNo != null and queryParam.caseNo != ''">
            AND tc.case_no LIKE concat("%",#{queryParam.caseNo},"%")
        </if>
        <if test="queryParam.identityCard != null and queryParam.identityCard != ''">
            AND tc.identity_card LIKE concat("%",#{queryParam.identityCard},"%")
        </if>
        ORDER BY
        tc.date
        DESC
    </select>
    <select id="listCaseByDentist" resultType="com.ricky.dentalclinic.dental.domain.CaseResultWithDentist">
        SELECT tc.*, tu.name as dentistName
        FROM
        t_case tc
        LEFT JOIN
        t_user tu
        ON
        tc.dentist_id = tu.id
        WHERE
        tc.is_delete = 0
        AND
        tc.dentist_id = #{dentistId}
        <if test="queryParam.name != null and queryParam.name != ''">
            AND tc.name LIKE concat("%",#{queryParam.name},"%")
        </if>
        <if test="queryParam.sex != null and queryParam.sex != ''">
            AND tc.sex = #{queryParam.sex}
        </if>
        <if test="queryParam.birthday != null and queryParam.birthday != ''">
            AND tc.birthday LIKE concat("%",#{queryParam.birthday},"%")
        </if>
        <if test="queryParam.phoneNumber != null and queryParam.phoneNumber != ''">
            AND tc.phone_number LIKE concat("%",#{queryParam.phoneNumber},"%")
        </if>
        <if test="queryParam.date != null and queryParam.date != ''">
            AND tc.date LIKE concat("%",#{queryParam.date},"%")
        </if>
        <if test="queryParam.caseNo != null and queryParam.caseNo != ''">
            AND tc.case_no LIKE concat("%",#{queryParam.caseNo},"%")
        </if>
        <if test="queryParam.identityCard != null and queryParam.identityCard != ''">
            AND tc.identity_card LIKE concat("%",#{queryParam.identityCard},"%")
        </if>
        ORDER BY
        tc.date
        DESC
    </select>
</mapper>